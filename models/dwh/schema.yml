version: 2

models:
  - name: transaction_with_line
    columns:
      - name: transaction_status
        tests:
          - accepted_values:
              name: unexpected_opportunity_status
              values: '{{ var("opportunity_open_scope") + var("opportunity_closed_scope") }}'
              config:
                where: "transaction_type = 'Opportunity'"
                severity: warn
      - name: transaction_status
        tests:
          - accepted_values:
              name: unexpected_sales_order_status
              values: '{{ var("sales_order_open_scope") + var("sales_order_closed_scope") }}'
              config:
                where: "transaction_type = 'Sales Order'"
                severity: warn
      - name: transaction_nsid
        tests:
          - not_null
      - name: transaction_line_nsid
        tests:
          - not_null
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - transaction_nsid
            - transaction_line_nsid
  - name: historized_transaction_with_line
    columns:
      - name: transaction_nsid
        tests:
          - not_null
      - name: transaction_line_nsid
        tests:
          - not_null
    tests:
      - dbt_utils.unique_combination_of_columns:
          combination_of_columns:
            - var("dbt_snapshot_col_name")
            - transaction_nsid
            - transaction_line_nsid